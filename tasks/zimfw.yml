---
- name: Ensure zimfw is installed
  community.general.homebrew:
    name: zimfw
    state: present

- name: Set ZIM_HOME to default location
  ansible.builtin.set_fact:
    zim_home: "{{ ansible_env.HOME }}/.zim"

- name: Check if zimfw modules are installed
  ansible.builtin.stat:
    path: "{{ zim_home }}/init.zsh"
  register: zimfw_init

- name: Get shell
  ansible.builtin.debug:
    var: $SHELL

- name: Install zimfw modules
  ansible.builtin.shell: |
    source ~/.zshrc
    rehash
    zimfw version
  when: not zimfw_init.stat.exists
  changed_when: true
  environment:
    ZIM_HOME: "{{ zim_home }}"
    PATH: "/opt/homebrew/bin:/usr/local/bin:{{ ansible_env.PATH }}"
  debugger: on_failed
