---
name: CI
'on':
  pull_request:
  push:
    branches: [master, molecule]

jobs:
  lint:
    name: Lint
    runs-on: ubuntu-latest
    steps:
      - name: Check out the codebase.
        uses: actions/checkout@v5
      - name: Lint YAML files
        uses: ibiqlik/action-yamllint@master
      - name: Run Ansible Lint
        uses: ansible/ansible-lint@main
      - name: Run shellcheck
        uses: ludeeus/action-shellcheck@master
        with:
          ignore_paths: .ansible

  integration_playbook:
    name: Integration tests for ansible playbook
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os:
          - macos-latest
          - macos-13
    steps:
      - name: Check out the codebase
        uses: actions/checkout@v5

      - name: Uninstall CI runners' built-in browser installs
        run: |
          sudo rm -rf /Applications/Firefox.app
          sudo rm -rf /Applications/Google\ Chrome.app

      - name: Run the tests
        uses: gofrolist/molecule-action@v2

  integration_setup_script:
    name: Integration tests for setup script
    runs-on: macos-latest
    steps:
      - name: Check out the codebase
        uses: actions/checkout@v5

      - name: Uninstall CI runners' built-in browser installs
        run: |
          sudo rm -rf /Applications/Firefox.app
          sudo rm -rf /Applications/Google\ Chrome.app

      - name: Uninstall CI runners' built-in Homebrew.
        run: tests/uninstall_homebrew.sh

      - name: Run the setup script
        run: ./setup.sh
